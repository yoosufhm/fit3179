<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
  <title>Total Plastic Waste Produced</title>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #974d22;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      padding: 20px;
      background-color: #db9834;
      color: white;
      margin: 0 0 30px 0;
      border-radius: 8px;
    }

    #bar_chart {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      max-width: 1200px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <h1>Plastic Pollution Analysis</h1>
  <div id="bar_chart"></div>

     
  <script type="text/javascript">
    var spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "params": [
        {
          "name": "minWaste",
          "value": 0,
          "bind": {
            "input": "range",
            "min": 0,
            "max": 100,
            "step": 5,
            "name": "Minimum Waste (MT): "
          }
        }
      ],
      "vconcat": [
        {
          "width": 800,
          "height": 450,
          "title": {
            "text": "Total Plastic Waste Produced by Country",
            "fontSize": 18,
            "anchor": "middle"
          },
          "projection": {"type": "equalEarth"},
          "data": {
            "url": "https://raw.githubusercontent.com/yoosufhm/fit3179/refs/heads/main/map.json",
            "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
          },
          "transform": [
            {
              "lookup": "properties.NAME_EN",  
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/yoosufhm/fit3179/refs/heads/main/Plastic%20Waste%20Around%20the%20World.csv",
                  "format": {"type": "csv"}
                },
                "key": "Country",
                "fields": ["Total_Plastic_Waste_MT"]
              }
            },
            {
              "calculate": "toNumber(datum.Total_Plastic_Waste_MT)",
              "as": "Total_Plastic_Waste_MT"
            },
            {
              "filter": "datum.Total_Plastic_Waste_MT >= minWaste || datum.Total_Plastic_Waste_MT == null"
            }
          ],
          "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
          "encoding": {
            "color": {
              "field": "Total_Plastic_Waste_MT",
              "type": "quantitative",
              "title": "Total Plastic Waste (MT)",
              "scale": {"scheme": "reds"}
            },
            "tooltip": [
              {"field": "properties.NAME_EN", "type": "nominal", "title": "Country"},
              {"field": "Total_Plastic_Waste_MT", "type": "quantitative", "title": "Total Plastic Waste (MT)", "format": ".2f"}
            ]
          }
        },
        {
          "width": 800,
          "height": 400,
          "title": {
            "text": "Total Plastic Waste Produced by Country (Top 20)",
            "fontSize": 18,
            "anchor": "middle"
          },
          "data": {
            "url": "https://raw.githubusercontent.com/yoosufhm/fit3179/refs/heads/main/Plastic%20Waste%20Around%20the%20World.csv",
            "format": {"type": "csv"}
          },
          "transform": [
            {
              "calculate": "toNumber(datum.Total_Plastic_Waste_MT)",
              "as": "Total_Plastic_Waste_MT"
            },
            {
              "filter": "datum.Total_Plastic_Waste_MT >= minWaste"
            },
            {
              "window": [{"op": "rank", "as": "rank"}],
              "sort": [{"field": "Total_Plastic_Waste_MT", "order": "descending"}]
            },
            {
              "filter": "datum.rank <= 20"
            }
          ],
          "layer": [
            {
              "mark": "bar",
              "encoding": {
                "x": {
                  "field": "Country",
                  "type": "nominal",
                  "title": "Country",
                  "sort": "-y",
                  "axis": {"labelAngle": -45, "labelFontSize": 10}
                },
                "y": {
                  "field": "Total_Plastic_Waste_MT",
                  "type": "quantitative",
                  "title": "Total Plastic Waste (MT)"
                },
                "color": {
                  "field": "Total_Plastic_Waste_MT",
                  "type": "quantitative",
                  "scale": {"scheme": "reds"},
                  "legend": null
                },
                "tooltip": [
                  {"field": "Country", "type": "nominal", "title": "Country"},
                  {"field": "Total_Plastic_Waste_MT", "type": "quantitative", "title": "Total Plastic Waste (MT)", "format": ".2f"},
                  {"field": "rank", "type": "quantitative", "title": "Rank"}
                ]
              }
            },
            {
              "mark": {
                "type": "text",
                "align": "center",
                "baseline": "bottom",
                "dy": -5,
                "fontSize": 9,
                "fontWeight": "bold"
              },
              "encoding": {
                "x": {
                  "field": "Country",
                  "type": "nominal",
                  "sort": "-y"
                },
                "y": {
                  "field": "Total_Plastic_Waste_MT",
                  "type": "quantitative"
                },
                "text": {
                  "field": "Total_Plastic_Waste_MT",
                  "type": "quantitative",
                  "format": ".1f"
                },
                "color": {"value": "black"},
                "opacity": {
                  "condition": {
                    "test": "datum.rank <= 5",
                    "value": 1
                  },
                  "value": 0
                }
              }
            }
          ]
        }
      ],
      "spacing": 40,
      "resolve": {"scale": {"color": "independent"}}
    };
      
    vegaEmbed("#bar_chart", spec, {actions: false}).then(function(result) {
    }).catch(console.error);
  </script>
</body>
</html>